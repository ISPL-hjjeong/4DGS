# 6개 평면 Feature 곱셈 결합 상세 설명

## 🎯 핵심 답변

**모든 평면에서 추출된 feature는 동일한 차원 [N, 32]입니다!**

그리드 크기(64×64, 25×64)와 feature 차원(32)은 **다른 개념**입니다.

---

## 🔍 혼동하기 쉬운 부분

### 그리드 크기 vs Feature 차원

**그리드 크기 (해상도):**
- xy 평면: 64×64 → 4,096개 격자점
- xt 평면: 25×64 → 1,600개 격자점

**Feature 차원:**
- 모든 평면: **32차원** (동일!)

---

## 📊 각 평면의 구조

### 공간 평면 (xy, xz, yz)

```python
# xy 평면 그리드
grid_xy = [1, 32, 64, 64]
#         │  │   │   └─ x축: 64개 격자점
#         │  │   └───── y축: 64개 격자점
#         │  └───────── feature 차원: 32 (모든 격자점마다)
#         └──────────── batch: 1
```

### 시간 평면 (xt, yt, zt)

```python
# xt 평면 그리드
grid_xt = [1, 32, 25, 64]
#         │  │   │   └─ x축: 64개 격자점
#         │  │   └───── t축: 25개 격자점
#         │  └───────── feature 차원: 32 (모든 격자점마다)
#         └──────────── batch: 1
```

**핵심**: 모든 평면에서 **feature 차원은 32로 동일**합니다!

---

## 🔄 Bilinear Interpolation 과정

### 각 평면에서 Feature 추출

#### xy 평면에서 추출

```python
# 입력
grid_xy = [1, 32, 64, 64]  # 그리드
coords_xy = [N, 2]  # (x, y) 좌표

# Bilinear Interpolation
interp_xy = grid_sample_wrapper(grid_xy, coords_xy)
# → [N, 32]  # 각 점마다 32차원 feature
```

**과정:**
1. (x, y) 좌표에 가장 가까운 4개 격자점 찾기
2. 각 격자점의 32차원 feature를 가중 평균
3. 결과: [N, 32]

#### xt 평면에서 추출

```python
# 입력
grid_xt = [1, 32, 25, 64]  # 그리드 (다른 크기!)
coords_xt = [N, 2]  # (x, t) 좌표

# Bilinear Interpolation
interp_xt = grid_sample_wrapper(grid_xt, coords_xt)
# → [N, 32]  # 각 점마다 32차원 feature (동일!)
```

**과정:**
1. (x, t) 좌표에 가장 가까운 4개 격자점 찾기
2. 각 격자점의 32차원 feature를 가중 평균
3. 결과: [N, 32] (xy 평면과 동일한 차원!)

---

## ✅ 곱셈 결합이 가능한 이유

### 모든 평면에서 동일한 출력 차원

```python
# 각 평면에서 추출된 feature
interp_xy = [N, 32]  # xy 평면
interp_xz = [N, 32]  # xz 평면
interp_xt = [N, 32]  # xt 평면
interp_yz = [N, 32]  # yz 평면
interp_yt = [N, 32]  # yt 평면
interp_zt = [N, 32]  # zt 평면

# 모두 [N, 32] 형태로 동일!
```

### Element-wise 곱셈

```python
# 초기값
interp_space = 1.  # [N, 32] 형태로 브로드캐스팅

# 첫 번째 평면 (xy)
interp_space = interp_space * interp_xy
# [N, 32] * [N, 32] = [N, 32]  ✅ 가능!

# 두 번째 평면 (xz)
interp_space = interp_space * interp_xz
# [N, 32] * [N, 32] = [N, 32]  ✅ 가능!

# ... 나머지 평면들도 동일하게
```

---

## 📐 구체적인 예시

### 예시: 3개 점에 대한 Feature 추출

```python
# 입력: 3개 점
pts = [
    [0.5, 0.3, -0.8, 0.2],  # 점 1: (x, y, z, t)
    [0.1, -0.5, 0.6, 0.5],  # 점 2
    [-0.3, 0.7, 0.2, 0.8]   # 점 3
]
# Shape: [3, 4]
```

### xy 평면에서 추출

```python
# xy 평면 그리드: [1, 32, 64, 64]
# (x, y) 좌표만 추출: [0.5, 0.3], [0.1, -0.5], [-0.3, 0.7]

interp_xy = [
    [f1_1, f1_2, ..., f1_32],  # 점 1의 32차원 feature
    [f2_1, f2_2, ..., f2_32],  # 점 2의 32차원 feature
    [f3_1, f3_2, ..., f3_32]   # 점 3의 32차원 feature
]
# Shape: [3, 32]
```

### xt 평면에서 추출

```python
# xt 평면 그리드: [1, 32, 25, 64]  (다른 그리드 크기!)
# (x, t) 좌표만 추출: [0.5, 0.2], [0.1, 0.5], [-0.3, 0.8]

interp_xt = [
    [g1_1, g1_2, ..., g1_32],  # 점 1의 32차원 feature
    [g2_1, g2_2, ..., g2_32],  # 점 2의 32차원 feature
    [g3_1, g3_2, ..., g3_32]   # 점 3의 32차원 feature
]
# Shape: [3, 32]  (xy 평면과 동일한 차원!)
```

### 곱셈 결합

```python
# 초기값
interp_space = [
    [1.0, 1.0, ..., 1.0],  # 점 1
    [1.0, 1.0, ..., 1.0],  # 점 2
    [1.0, 1.0, ..., 1.0]   # 점 3
]
# Shape: [3, 32]

# xy 평면 곱하기
interp_space = interp_space * interp_xy
# = [
#     [1.0*f1_1, 1.0*f1_2, ..., 1.0*f1_32],  # 점 1
#     [1.0*f2_1, 1.0*f2_2, ..., 1.0*f2_32],  # 점 2
#     [1.0*f3_1, 1.0*f3_2, ..., 1.0*f3_32]   # 점 3
# ]
# Shape: [3, 32]

# xt 평면 곱하기
interp_space = interp_space * interp_xt
# = [
#     [f1_1*g1_1, f1_2*g1_2, ..., f1_32*g1_32],  # 점 1
#     [f2_1*g2_1, f2_2*g2_2, ..., f2_32*g2_32],  # 점 2
#     [f3_1*g3_1, f3_2*g3_2, ..., f3_32*g3_32]   # 점 3
# ]
# Shape: [3, 32]  ✅ 가능!
```

---

## 🔑 핵심 개념 정리

### 1. 그리드 크기 ≠ Feature 차원

| 평면 | 그리드 크기 | Feature 차원 | 추출된 Feature Shape |
|------|------------|-------------|---------------------|
| xy | 64×64 | 32 | [N, 32] |
| xz | 64×64 | 32 | [N, 32] |
| xt | 25×64 | 32 | [N, 32] |
| yz | 64×64 | 32 | [N, 32] |
| yt | 25×64 | 32 | [N, 32] |
| zt | 25×64 | 32 | [N, 32] |

**모든 평면에서 추출된 feature는 [N, 32]로 동일합니다!**

### 2. 그리드 크기의 역할

- **그리드 크기**: 얼마나 세밀한 격자로 나눴는지 (해상도)
- **Feature 차원**: 각 격자점에 저장된 정보의 차원 (모두 32)

### 3. Bilinear Interpolation의 역할

- 그리드 크기가 달라도, interpolation 결과는 항상 [N, 32]
- 각 평면의 그리드에서 해당 좌표의 feature를 추출
- 결과는 항상 동일한 차원 [N, 32]

---

## 💡 비유로 이해하기

**비유: 다른 크기의 지도에서 정보 찾기**

```
지도 A (64×64 크기):
  - 4,096개의 위치에 정보 저장
  - 각 위치마다 32개의 정보 항목

지도 B (25×64 크기):
  - 1,600개의 위치에 정보 저장
  - 각 위치마다 32개의 정보 항목 (동일!)

특정 좌표에서 정보 찾기:
  - 지도 A에서 찾기 → 32개 정보 항목
  - 지도 B에서 찾기 → 32개 정보 항목 (동일!)

두 정보를 곱하기:
  - [32개] × [32개] = [32개]  ✅ 가능!
```

---

## 🎯 요약

1. **그리드 크기는 다름**: xy는 64×64, xt는 25×64
2. **Feature 차원은 동일**: 모든 평면에서 32차원
3. **Interpolation 결과는 동일**: 모든 평면에서 [N, 32]
4. **곱셈 결합 가능**: [N, 32] × [N, 32] = [N, 32]

**핵심**: 그리드 크기가 달라도, interpolation을 통해 추출된 feature는 모두 [N, 32]로 동일하므로 곱셈 결합이 가능합니다!

